<div class="user-panel">
  <!-- LOADING -->
  <div *ngIf="isLoading" class="loading">Loading...</div>

  <!-- ERROR -->
  <div *ngIf="errorMessage" class="error">{{ errorMessage }}</div>

  <!-- USER -->
  <div class="user-header" *ngIf="user">
    <span class="username">@{{ user.username }}</span>
    <span class="display-name">{{ user.name }}</span>
    <span class="rating">â­ rating: {{ user.ratingNumber }}</span>
  </div>

  <div class="divider" *ngIf="user"></div>

  <!-- RECENT SONGS -->
  <div class="section" *ngIf="!isLoading">
    <h3>ğŸµ Recent songs</h3>
    <ul *ngIf="recentSongs.length > 0">
      <li *ngFor="let song of recentSongs">
        {{ song.title }} â€“ {{ song.artist }}
        <span class="category">({{ song.category }})</span>
      </li>
    </ul>
    <p *ngIf="recentSongs.length === 0">No songs yet.</p>
  </div>

  <div class="divider" *ngIf="!isLoading"></div>

  <!-- BADGES -->
  <div class="section" *ngIf="!isLoading">
    <h3>ğŸ† Badges</h3>
    <ul *ngIf="badges.length > 0">
      <li *ngFor="let badge of badges">
        <strong>{{ badge.name }}</strong>
        <span class="badge-desc">â€“ {{ badge.description }}</span>
      </li>
    </ul>
    <p *ngIf="badges.length === 0">No badges yet.</p>
  </div>

  <div class="divider" *ngIf="!isLoading"></div>

  <!-- GROUPS -->
  <button class="retro-btn" (click)="toggleGroups()" *ngIf="!isLoading">
    {{ showGroups ? 'Hide groups' : 'Show groups' }}
  </button>

  <ul *ngIf="showGroups && groups.length > 0" class="groups">
    <li *ngFor="let group of groups" (click)="openGroupPopup(group)" class="group-item">
      ğŸ‘¥ {{ group.name }}
    </li>
  </ul>
  <p *ngIf="showGroups && groups.length === 0">No groups yet.</p>

  <div class="divider" *ngIf="!isLoading"></div>

  <!-- LOGOUT -->
  <button class="retro-btn logout-btn" (click)="logout()" *ngIf="!isLoading">
    ğŸšª Logout
  </button>
</div>

<!-- GROUP POPUP MODAL -->
<div class="modal-overlay" *ngIf="selectedGroup" (click)="closeGroupPopup()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="closeGroupPopup()">âœ•</button>
    
    <h2 class="modal-title">ğŸ‘¥ {{ selectedGroup.name }}</h2>

    <div *ngIf="isLoadingGroup" class="modal-loading">Loading...</div>

    <div *ngIf="!isLoadingGroup">
      <!-- MEMBERS -->
      <div class="modal-section">
        <h3>ğŸ‘¤ Members</h3>
        <ul *ngIf="selectedGroup.members && selectedGroup.members.length > 0">
          <li *ngFor="let member of selectedGroup.members">
            <span class="member-name">{{ member.name }}</span>
            <span class="member-username">@{{ member.username }}</span>
          </li>
        </ul>
        <p *ngIf="!selectedGroup.members || selectedGroup.members.length === 0">No members yet.</p>
      </div>

      <!-- SHARED SONGS -->
      <div class="modal-section">
        <h3>ğŸµ Shared Songs</h3>
        <ul *ngIf="selectedGroup.sharedSongs && selectedGroup.sharedSongs.length > 0">
          <li *ngFor="let song of selectedGroup.sharedSongs">
            <span class="song-title">{{ song.title }}</span>
            <span class="song-artist">â€“ {{ song.artist }}</span>
          </li>
        </ul>
        <p *ngIf="!selectedGroup.sharedSongs || selectedGroup.sharedSongs.length === 0">No shared songs yet.</p>
      </div>
    </div>
  </div>
</div>
